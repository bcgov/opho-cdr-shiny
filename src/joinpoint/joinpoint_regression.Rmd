---
title: 'DRAFT: BC Chronic Diseases trends by Sex (2001–2020): A joinpoint regression analysis'
date: "`r format(Sys.time(), '%d %B, %Y')`"
author: 'Mahmoodur Rahman'
output:
  html_document:
    df_print: paged
    code_folding: hide
bibliography: joinpoint_ref.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE)
```



```{r libraries}
library(dplyr)
library(readr)
library(plotly)
library(lubridate)
library(segmented)
```
# Highlevel tasks:

## Background / Methodology / Literature review / Rationale: (Will write rationale of this approach)

List of papers:

 - segmented: an R Package to Fit Regression Models with Broken-Line Relationships. (@muggeo2008segmented)
 - Estimating regression models with unknown break-points. (@muggeo2003estimating)
 - Global increasing incidence of young-onset colorectal cancer across 5 continents: a joinpoint regression analysis of 1,922,167 cases (@lui2019global)
 - Spatial clusters and temporal trends of malignant melanoma mortality in Ecuador. (@nunez2020spatial)
 - Worldwide suicide mortality trends by firearm (1990–2019): A joinpoint regression analysis (@ilic2022worldwide)
 
## Data Pre-processing:

### Loading data

```{r Load Data}
df <- read_csv("/Users/mahmood/UBCMDS/591_capstone/master_df.csv") |> 
    mutate( RATE = as.factor(RATE)) |> 
    mutate( DISEASE = as.factor(DISEASE)) |> 
    mutate( SEX = as.factor(SEX)) |> 
    mutate( HEALTH_BOUNDARIES = as.factor(HEALTH_BOUNDARIES)) |> 
    mutate( GEOGRAPHY = as.factor(GEOGRAPHY))

```

### Exploratory data analysis

#### Plotting of Rate against Time: 

The following graph plots Sex-wise Age-standardized Incidence Rate of ALZHEIMER_DEMENTIA in from 2001 to 2020  (Will label the graph)

```{r eda}
# sample data
sample_df <- df %>%
  filter(RATE == "INCIDENCE" &
           DISEASE == "ALZHEIMER_DEMENTIA" & 
           GEOGRAPHY == "CHSA" &
           HEALTH_BOUNDARIES == "1110 Fernie")

sample_df %>%
  ggplot( aes(x=YEAR, y=STD_RATE_PER_1000, group=SEX, color=SEX)) +
  geom_line()

```

Observations: (Will elaborate later)

 - "Breakpoints" can be seen. Not smooth
 - Each "Piece" is considered a linear relation between Rates and Time (Year)
 
#### Summery sattistics of rates:

```{r rates summary}

hsc_df <- df %>%
  filter(RATE == "HSC")
incidence_rate_df <- df %>%
  filter(RATE == "INCIDENCE")
lif_prevalence_df <- df %>%
  filter(RATE == "LIFE_PREV")

summary(hsc_df$STD_RATE_PER_1000)
summary(incidence_rate_df$STD_RATE_PER_1000)
summary(lif_prevalence_df$STD_RATE_PER_1000)

```
Observations: (Will elaborate later)

 - None of the three rates, namely, HSC Prevalence, Age-Standardized Incidence Rate, and  Age-Standardized Life Prevalence have any negative value

## Building the Model:

### Specifics :

 - Model : Linear regression 
 - Response (y): Rates 
 - Predictors : Sex*Year
 - `segmented.lm` is used
 
```{r linear regression}
attach(sample_df)
lm <- lm(STD_RATE_PER_1000~SEX*YEAR)
seg_model<-segmented(lm,seg.Z=~YEAR)
```









 
# References
 
 
 
 
 
 
 
 